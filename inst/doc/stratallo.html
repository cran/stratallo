<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Optimum Sample Allocation in Stratified Sampling Schemes with Stratallo Package</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Optimum Sample Allocation in Stratified
Sampling Schemes with Stratallo Package</h1>



<p>The goal of <em>stratallo</em> package is to provide implementations
of the efficient algorithms that solve a classical problem in survey
methodology - an optimum sample allocation problem in stratified
sampling schemes. In this context, the classical problem of optimum
sample allocation is the Tschuprov-Neyman’s sense <span class="citation">(Neyman 1934; Tschuprov 1923)</span>. It is formulated
as determination of a vector of strata sample sizes that minimizes the
variance of the <span class="math inline">\(\pi\)</span>-estimator of
the population total of a given study variable, under constraint on
total sample size. This problem can be further complemented by adding
lower or upper bounds constraints on sample sizes is strata.</p>
<p>A minor modification of the classical optimium sample allocation
problem leads to the minimum sample size allocation. This problems lies
in the determination of a vector of strata sample sizes that minimizes
total sample size, under assumed fixed level of the <span class="math inline">\(\pi\)</span>-estimator’s variance. As in the case
of the classical optimal allocation, the problem of minimum sample size
allocation can be complemented by imposing upper bounds constraints on
sample sizes in strata.</p>
<p><em>Stratallo</em> provides two user functions, <code>dopt</code> and
<code>nopt</code> that solve sample allocation problems briefly
characterized above. In this context, it is assumed that the sampling
designs in strata are chosen so that the variance of the <span class="math inline">\(\pi\)</span>-estimator of the population total is
of the following generic form: <span class="math display">\[
  D^2_{st}(x_w,\, w \in \mathcal W) = \sum_{w \in \mathcal W}\,
\frac{a_w^2}{x_w} - b,
\]</span> where <span class="math inline">\(\mathcal W= \{1, \ldots,
H\}\)</span> denotes set of strata labels with total number of strata
equals to <span class="math inline">\(H\)</span>, <span class="math inline">\((x_w)_{w \in \mathcal W}\)</span> are the strata
sample sizes, and parameters <span class="math inline">\(b\)</span>, and
<span class="math inline">\(a_w &gt; 0,\, w \in \mathcal W\)</span>, do
not depend on the <span class="math inline">\((x_w)_{w \in \mathcal
W}\)</span>. Among the stratified sampling designs that have the <span class="math inline">\(\pi\)</span>-estimator’s variance of the above
form is stratified simple random sampling without replacement design.
Under this design <span class="math inline">\(a_w = N_w S_w,\, w \in
\mathcal W\)</span> and <span class="math inline">\(b = \sum_{w \in
\mathcal W}\, N_w S_w^2\)</span>, where <span class="math inline">\(S_w,\, w \in \mathcal W\)</span>, denote stratum
standard deviations of study variable and <span class="math inline">\(N_w,\, w \in \mathcal W\)</span>, are the strata
sizes (see e.g. <span class="citation">Sarndal et al. (1993)</span>,
Result 3.7.2, p. 103).</p>
<p>Apart from <code>dopt</code> and <code>nopt</code>,
<em>stratallo</em> provides <code>var_tst</code> and
<code>var_tst_si</code> functions that compute a value of variance <span class="math inline">\(D^2_{st}\)</span>. The <code>var_tst_si</code> is
a simple wrapper of <code>var_tst</code> that is dedicated for the case
of simple random sampling without replacement design in each stratum.
Furthermore, the package comes with two predefined, artificial
populations with 507 and 969 strata. These are stored in
<code>pop507</code> and <code>pop969</code> objects respectively.</p>
<div id="minimization-of-the-variance-with-dopt-function" class="section level2">
<h2>Minimization of the variance with <code>dopt</code> function</h2>
<p>The <code>dopt</code> function solves the following two types of the
allocation problem, formulated in the language of mathematical
optimization.</p>
<p><strong>Problem 1 (one-sided upper bounds constraints)</strong><br />
Given numbers <span class="math inline">\(a_w &gt; 0,\, M_w &gt; 0,\, w
\in \mathcal W\)</span> and <span class="math inline">\(b,\, n &lt;
\sum_{w \in \mathcal W}\, M_w\)</span>, <span class="math display">\[\begin{align*}
    \underset{\mathbf x\in (0, +\infty)^{H}}{\mathrm{minimize ~\,}}
&amp; \quad f(\mathbf x) = \sum_{w \in \mathcal W} \tfrac{a_w^2}{x_w} -
b \\
    \mathrm{subject ~ to} &amp; \quad \sum_{w \in \mathcal W} x_w = n \\
    &amp; \quad x_w \le M_w, \quad \forall w \in \mathcal W,
\end{align*}\]</span> where <span class="math inline">\(\mathbf x=
(x_w)_{w \in \mathcal W}\)</span> is the optimization variable.</p>
<p><strong>Problem 2 (one-sided lower bounds constraints)</strong><br />
Given numbers <span class="math inline">\(a_w &gt; 0,\, m_w &gt; 0,\, w
\in \mathcal W\)</span>, and <span class="math inline">\(b,\, n &gt;
\sum_{w \in \mathcal W} m_w\)</span>, <span class="math display">\[\begin{align*}
    \underset{\mathbf x\in (0, +\infty)^{H}}{\mathrm{minimize ~\,}}
&amp; \quad f(\mathbf x) = \sum_{w \in \mathcal W} \tfrac{a_w^2}{x_w} -
b \\
    \mathrm{subject ~ to} &amp; \quad \sum_{w \in \mathcal W} x_w = n \\
    &amp; \quad x_w \geq m_w, \quad \forall w \in \mathcal W,
\end{align*}\]</span> where <span class="math inline">\(\mathbf x=
(x_w)_{w \in \mathcal W}\)</span> is the optimization variable.</p>
<p>User of <code>dopt</code> can choose whether the solution computed
will be for <strong>Problem 1</strong> or <strong>Problem 2</strong>
This is achieved with the proper use of <code>m</code> and
<code>M</code> arguments of the function. In case of <strong>Problem
1</strong>, user provides the values of upper bounds with <code>M</code>
argument, while leaving <code>m</code> as <code>NULL</code>. Similarly,
for <strong>Problem 2</strong>, user provides the values of lower bounds
with <code>m</code> argument, while leaving <code>M</code> as
<code>NULL</code>. If both <code>m</code> and <code>M</code> are
specified as <code>NULL</code> (default), the <code>dopt</code> returns
the value of Tschuprov-Neyman allocation that minimizes variance <span class="math inline">\(D^2_{st}\)</span> under constraints on total
sample size <span class="math inline">\(\sum_{w \in \mathcal W} x_w =
n\)</span>, and it is given by <span class="math display">\[
  x_w = a_w \frac{n}{\sum_{w \in \mathcal W} a_w}, \quad w \in \mathcal
W
\]</span> There are four different algorithms available to use for
<strong>Problem 1</strong>, <em>rNa</em> (default), <em>sga</em>,
<em>sgaplus</em>, <em>coma</em>. All these algorithms, except
<em>sgaplus</em>, are described in detail in <span class="citation">Wesołowski et al. (2021)</span>. The <em>sgaplus</em>
is defined in <span class="citation">Wójciak (2019)</span> as
<em>Sequential Allocation (version 1)</em> algorithm.</p>
<p>The optimization <strong>Problem 2</strong> is solved by the
<em>LrNa</em> that in principle is based on the <em>rNa</em> and it is
introduced in <span class="citation">Wójciak (2022)</span>.</p>
</div>
<div id="minimization-of-the-total-sample-size-nopt-function" class="section level2">
<h2>Minimization of the total sample size <code>nopt</code>
function</h2>
<p>The <code>nopt</code> function solves the following minimum sample
size allocation problem, formulated in the language of mathematical
optimization.</p>
<p><strong>Problem 3</strong><br />
Given numbers <span class="math inline">\(a_w &gt; 0,\, M_w &gt; 0,\, w
\in \mathcal W\)</span>, and <span class="math inline">\(b,\, D &gt;
\sum_{w \in \mathcal W} \tfrac{a_w^2}{M_w} - b &gt; 0\)</span>, <span class="math display">\[\begin{align*}
    \underset{\mathbf x\in (0, +\infty)^{H}}{\mathrm{minimize ~\,}}
&amp; \quad n(\mathbf x) = \sum_{w \in \mathcal W} x_w \\
    \mathrm{subject ~ to} &amp; \quad \sum_{w \in \mathcal W}
\tfrac{a_w^2}{x_w} - b = D \\
    &amp; \quad x_w \le M_w, \quad \forall w \in \mathcal W,
\end{align*}\]</span> where <span class="math inline">\(\mathbf x=
(x_w)_{w \in \mathcal W}\)</span> is the optimization variable.</p>
<p>The algorithm that solves <strong>Problem 3</strong> is based on the
<em>LrNa</em> and it is described in <span class="citation">Wójciak
(2022)</span>.</p>
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>You can install the released version of <em>stratallo</em> package
from <a href="https://CRAN.R-project.org">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;stratallo&quot;</span>)</span></code></pre></div>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<p>These are basic examples that show how to use <code>dopt</code> and
<code>nopt</code> functions to solve optimal sample allocation problems
for an example population with 4 strata.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stratallo)</span></code></pre></div>
<div id="function-dopt" class="section level3">
<h3>Function <code>dopt</code></h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define example population</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3000</span>, <span class="dv">4000</span>, <span class="dv">5000</span>, <span class="dv">2000</span>) <span class="co"># Strata sizes.</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">48</span>, <span class="dv">79</span>, <span class="dv">76</span>, <span class="dv">17</span>) <span class="co"># Standard deviations of a study variable in strata.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> N <span class="sc">*</span> S</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">90</span>, <span class="dv">70</span>, <span class="dv">80</span>) <span class="co"># Upper bounds constraints imposed on the sample sizes in strata.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(M <span class="sc">&lt;=</span> N)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">190</span> <span class="co"># Total sample size.</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>n <span class="sc">&lt;</span> <span class="fu">sum</span>(M)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution to Problem 1.</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>opt <span class="ot">&lt;-</span> <span class="fu">dopt</span>(<span class="at">n =</span> n, <span class="at">a =</span> a, <span class="at">M =</span> M)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>opt</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 34.979757 76.761134 70.000000  8.259109</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(opt) <span class="co"># Equals to n.</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 190</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(opt <span class="sc">&lt;=</span> M) <span class="co"># Does not violate upper bounds constraints.</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance of the pi-estimator that corresponds to a given optimal allocation.</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">var_tst_si</span>(opt, N, S)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 4035156476</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">120</span>, <span class="dv">1</span>, <span class="dv">1</span>) <span class="co"># Lower bounds constraints imposed on the sample sizes in strata.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>n <span class="sc">&gt;</span> <span class="fu">sum</span>(m)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution to Problem 2.</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>opt <span class="ot">&lt;-</span> <span class="fu">dopt</span>(<span class="at">n =</span> n, <span class="at">a =</span> a, <span class="at">m =</span> m)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>opt</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1]  50.000000 120.000000  18.357488   1.642512</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(opt) <span class="co"># Equals to n.</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 190</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(opt <span class="sc">&gt;=</span> m) <span class="co"># Does not violate lower bounds constraints.</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance of the pi-estimator that corresponds to a given optimal allocation.</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">var_tst_si</span>(opt, N, S)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 9755319333</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Tschuprov-Neyman allocation (no inequality constraints).</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>opt <span class="ot">&lt;-</span> <span class="fu">dopt</span>(<span class="at">n =</span> n, <span class="at">a =</span> a)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>opt</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 31.304348 68.695652 82.608696  7.391304</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(opt) <span class="co"># Equals to n.</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 190</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance of the pi-estimator that corresponds to a given optimal allocation.</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">var_tst_si</span>(opt, N, S)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3959066000</span></span></code></pre></div>
</div>
<div id="function-nopt" class="section level3">
<h3>Function <code>nopt</code></h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3000</span>, <span class="dv">4000</span>, <span class="dv">5000</span>, <span class="dv">2000</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">70000</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">90</span>, <span class="dv">70</span>, <span class="dv">80</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fl">1e6</span> <span class="co"># Variance constraint.</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>opt <span class="ot">&lt;-</span> <span class="fu">nopt</span>(D, a, b, M)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(opt)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 183.1776</span></span></code></pre></div>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-neyman" class="csl-entry">
Neyman, J. (1934), <span>“On the Two Different Aspects of the
Representative Method: The Method of Stratified Sampling and the Method
of Purposive Selection,”</span> <em>Journal of the Royal Statistical
Society</em>, 97, 558–606.
</div>
<div id="ref-sarndal" class="csl-entry">
Sarndal, C.-E., Swensson, B., and Wretman, J. (1993), <em>Model Assisted
Survey Sampling</em>, Springer.
</div>
<div id="ref-tschuprov" class="csl-entry">
Tschuprov, A. A. (1923), <span>“On the Mathematical Expectation of the
Moments of Frequency Distributions in the Case of Correlated
Observations,”</span> <em>Metron</em>, 2, 461–493, 646–683.
</div>
<div id="ref-wesolowski2021" class="csl-entry">
Wesołowski, J., Wieczorkowski, R., and Wójciak, W. (2021),
<span>“Optimality of the Recursive Neyman Allocation,”</span>
<em>Journal of Survey Statistics and Methodology</em>. <a href="https://doi.org/10.1093/jssam/smab018">https://doi.org/10.1093/jssam/smab018</a>.
<a href="https://arxiv.org/abs/2105.14486">https://arxiv.org/abs/2105.14486</a>.
</div>
<div id="ref-wojciak2019" class="csl-entry">
Wójciak, W. (2019), <span>“Optimal Allocation in Stratified Sampling
Schemes,”</span> <em>MSc Thesis</em>, Warsaw University of Technology.
<a href="http://home.elka.pw.edu.pl/~wwojciak/msc_optimal_allocation.pdf">http://home.elka.pw.edu.pl/~wwojciak/msc_optimal_allocation.pdf</a>.
</div>
<div id="ref-wojciak2022" class="csl-entry">
Wójciak, W. (2022), <span>“Minimum Sample Size Allocation in Stratified
Sampling Under Constraints on Variance and Strata Sample Sizes.”</span>
<a href="https://doi.org/10.48550/arXiv.2204.04035">https://doi.org/10.48550/arXiv.2204.04035</a>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
